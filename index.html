
<!DOCTYPE html>
<html lang="en">
<head>
	<title>Covid-19 Impacts on World Regions</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
	<script src='https://d3js.org/d3.v5.min.js'></script>
	<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>

	<style> /* CSS Style */
		body {
			margin: 0;
        	font-family: sans-serif;
        	font-size: 11px
		}
		p {
			font-size: 14px
		}
		path {
			stroke-width: 3;
			fill: none;
		}
		.axis path,
		.axis line {
			fill: none;
			stroke: rgb(122, 122, 122);
			shape-rendering: crispEdges;
		}
		.axis text{
			font-size: 12px;
			font-weight: bold;
		}
		.label{
			font-size: 12px;
			font-weight: bold;
			text-anchor: middle;
		}
		.legend {
			font-size: 12px;
			font-weight: bold;
			text-anchor: left;
		}
		.annotation path {
			fill: none;
			stroke: grey;
			shape-rendering: crispEdges;
			stroke-width: 1;
		}
		.annotation text {
			font-size: 12px;
  			text-shadow: -2px 0 2px #fff,
						  0 2px 2px #fff,
						  2px 0 2px #fff,
						  0 -2px 2px #fff;
		}
		div.tooltip {
			position: absolute;
			text-align: left;
			font: 12px sans-serif;
			font-weight: bold;
			background: rgb(255, 255, 255);
			pointer-events: none;
		}
		.jumbotron {
			background-size: cover;
			padding-top: 1%;
			padding-bottom: 0.5%;
		}
		.container-fluid {
			padding-right: 15px;
			padding-left: 15px;
			margin-right: auto;
			margin-left: auto;
		}
		.row {
			margin-right: -15px;
			margin-left: -15px;
		}
		option {
			margin-left:20px;
		}
	</style>

</head>
<body>
	<div class="jumbotron text-center">
		<h2>Impact of Corona Virus on World Regions</h2>
		<h6>Praveen Pathri</h6>
		<h6><script> document.write(new Date().toLocaleDateString()); </script></h6>
	</div>

	<div class="container-fluid">
		<h4><strong>Monthly Trend of new Coronavirus cases</strong></h4>
		<p> Coronavirus had its origin in <b>East Asia & Pacific</b> World Region, in Wuhan, a city in Central China.
		This Virus spread quickly to all the other World Regions. It's impact is seen today in almost 253 countries across the World.
		</p>

		<p>Started in December 2019, the Virus spread quickly to <b>Europe & Central Asia</b> Region, sparked by International travel,
		new confirmed cases began to raise in Spain, Italy & France.<br> Europe & Central Asia Region recorded higher new confrmed caess in the month of April, 2020
		<br><b>North American</b> region followed closely with new confirmed cases raising in the month of April 2020 in US and Canada<br>
		Agressive lockdown measures and suspension of travel in China contained the spread of the virus in East Asia Pacific region<br>
		Social Distancing, Quarantine efforts, lockdown and suspension of International Travel in  Europe & Central Asia and North American regions showed a downward trend in the month of May, 2020<br>
		<b>Latin America & Caribbean</b> region recorded peak new confirmed cases in the month of June, 2020 with highest cases recorded in Brazil, Chile, Peru, Mexico<br>
		New Coronavirus cases began to raise again in July, 2020 in North American region following the lifting of lockdown in some US states <br>
		Slow but steady raise in new cases is being recorded in <b>Middle East & North Africa, South Asia and Sub-Saharan Africa</b> regions
		</p>

		</br>

		<h6><strong>Report Trends:</strong></h6>
		<p> Below report show the reader the following trends
					<ol  style="font-size:14px">
					<li><strong>Trend of Covid-19 New Confirmed cases by Month</strong></li>
					<li><strong>Trend of Covid-19 New Deaths by Month</strong></li>
					<li><strong>Trend of Covid-19 New Recovered cases by Month</strong></li>

			</ol>
			Reader can click on the buttons below to view the repsective trend, filter by clicking on the legend and mouseover datapoint to view additional details
		</p>
		</br>
	</div>

	<div class="container-fluid">
		<h6><strong>Select the aspect you are interested in:</strong></h6>

		<div id="option">
			<input name="ConfirmedButton"
					type="button"
					class ="btn btn-info"
					value="Confirmed"
					onclick="confirmedData()" />

			<input name="DeathsButton"
					type="button"
					class ="btn btn-info"
					value="Deaths"
					onclick="deathsData()" />

			<input name="RecoveredButton"
					type="button"
					class ="btn btn-info"
					value="Recovered"
					onclick="recoveredData()" />
		</div>

		<script>
			//Set Margin
			var margin = {top: 30, right: 20, bottom: 70, left: 150},
			width = 1000 - margin.left - margin.right,
			height = 600 - margin.top - margin.bottom;

			// * Define Scales
			// var x = d3.scaleTime().range([0, width]);
			var x = d3.scaleLinear().range([0, width]);
			var y = d3.scaleLinear().range([height, 0]);
			var color = d3.scaleOrdinal().range(d3.schemeCategory10);



			// Define Axes
			var tickLabels = ['Jan','Feb','Mar','Apr','May','Jun','Jul']
			var xAxis = d3.axisBottom().scale(x).ticks(7).tickFormat(function(d,i){return tickLabels[i];});
			var yAxis = d3.axisLeft().scale(y).ticks(15);

			// Define Confirmed Cases Line (Confirmed vs Month)
			var confirmedline = d3.line()
				.x(function(d) { return x(d.Month); })
				.y(function(d) { return y(d.Confirmed); })
				.curve(d3.curveMonotoneX);

			// Define No of Deaths Line (Deaths vs Month)
			var deathline = d3.line()
				.x(function(d) { return x(d.Month); })
				.y(function(d) { return y(d.Deaths); })
				.curve(d3.curveMonotoneX);

			// Define Recovery Cases Line (Recovered Cases vs Month)
			var recoveredline = d3.line()
				.x(function(d) { return x(d.Month); })
				.y(function(d) { return y(d.Recovered); })
				.curve(d3.curveMonotoneX);

			// Defile ToolTip
			var div = d3.select("body").append("div")
				.attr("class", "tooltip")
				.style("opacity", 0);

			// SVG Canvas
			var svg = d3.select("body")
				.append("svg")
					.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom)
				.append("g")
					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			// Parse Year
			var parseDate = d3.timeParse("%B");

			// Default load Covid Data
			confirmedData();

			// Handle Covid button click
			function confirmedData() {
				svg.selectAll("*").remove();

				// Get the data again
				d3.csv("data/covid.csv")
				.then(function(data) {
					data.forEach(function(d) {
						d.Month = d.Month;
						d.Confirmed = +d.Confirmed;
						d.Deaths = +d.Deaths
						d.Recovered = +d.Recovered
					});

				// Scale the range of data
				x.domain(d3.extent(data, function(d) { return d.Month; }));
				y.domain([0, d3.max(data, function(d) { return d.Confirmed; })]);

				// Nest the entries by Region
				var dataNest = d3.nest()
					.key(function(d) {return d.Region;})
					.entries(data);

					// Loop through each symbol/key
					dataNest.forEach(function(d,i) {
						svg.append("path")
							.attr("class", "line")
							.style("stroke", function() {
							   return d.color = color(d.key); })
							.attr("id", 'tag'+d.key.replace(/[\s\&]+/g, ''))
							.attr("d", confirmedline(d.values));

						// Add points with tooltips
						svg.selectAll("dot")
							.data(data)
						.enter().append("circle")
							.attr("r", 3.5)
							.attr("cx", function(d) { return x(d.Month); })
							.attr("cy", function(d) { return y(d.Confirmed); })
							.style("fill", "grey")
							.on("mouseover", function(d) {
								d3.select(this)
									.attr("r", 8)
        							.style("fill", "purple");
								div.transition()
									.duration(200)
									.style("opacity", 0.9);
								div.html(
										"Region: " + d.Region + "<br/>" +
										"Month: " + d.Month + "<br/>" +
										"Confirmed: " + d.Confirmed + " <br/>" +
										"Deaths: " + d.Deaths + "<br/>" +
										"Recovered: " + d.Recovered)
									.style("left", (d3.event.pageX) + "px")
									.style("top", (d3.event.pageY - 28) + "px");
							})
							.on("mouseout", function(d) {
								d3.select(this)
									.attr("r", 3.5)
        							.style("fill", "grey");
								div.transition()
									.duration(500)
									.style("opacity", 0);
							});

						// Add Legend
						svg.append("text")
							.attr("x", 25)
							.attr("y", 20)
							.attr("class", "legend")
							.text("LEGEND - WORLD REGIONS")

						svg.append("line")
							.attr("x1", 25)
							.attr("x2", 45)
							.attr("y1", 40 + i * 20)
							.attr("y2", 40 + i * 20)
							.style("stroke-width", 3)
							.style("stroke", function() {
								return d.color = color(d.key); })
							.on("click", function(){
								var active   = d.active ? false : true,
								newOpacity = active ? 0.10 : 1;
								d3.select("#tag"+d.key.replace(/[\s\&]+/g, ''))
									.transition().duration(100)
									.style("opacity", newOpacity);
								d.active = active;
								});

						var active = true;
						svg.append("text")
							.attr("x", 55)
							.attr("y", 46 + i * 20)
							.attr("class", "legend")
							.style("fill", function() {
								return d.color = color(d.key); })
							.on("click", function(){
							    active   = d.active ? false : true;
								// alert("test"+d.active);
								newOpacity = active ? 0.10 : 1;
								// alert("#tag"+d.key.replace(/[\s\&]+/g, ''));
								d3.select("#tag"+d.key.replace(/[\s\&]+/g, ''))
									.transition().duration(100)
									.style("opacity", newOpacity);
								// alert(active);
								d.active = active;
								})
							.text(d.key);

						// Annotations
						const annotations = [
						{note: {label: "Started in Wuhan, China(East Asia & Pacific Region) in late 2019. Named as Covid-19, the virus spread quickly and crossed regional boundaries. Agressive measures taken later locally, contained regional spread",
								title: "Covid Outbreak", align: "left"},
								x: 0, y: 500, dy: -50, dx: 20},
						{note: {label: "International travel spread the Virus to other regions, first impacts are seen in Europe & Central Asia Region (UK, Spain, Italy, Turkey, France, Germany, Russia).",
								title: "Inter-Regional Spread", align: "right"},
								x: 277, y: 344, dy: -25, dx: 15},
						{note: {label: "North American(US & Canada), Europe & Central Asia Regions, recorded high confirmed cases in the month of Apr 2020.",
								title: "Spread to North American Region", align: "left"},
								x: 415, y: 202, dy: -80, dx: -110},
						{note: {label: "",
								title: "", align: "left"},
								x: 415, y: 179, dy: -57, dx: -110},
						{note: {label: "Measures to control the spread of Virus through Social distancing & lockdowns started showing positive results.",
								title: "Social Distancing", align: "Middle"},
								x: 553, y: 286, dy: 0, dx: -190},

						{note: {label: "Latin America & Caribbean Region(Brazil,Peru, Mexico,..) is highly impacted with the # of confirmed cases raising.",
														title:  "Highly Impacted Region", align: "right"},
								x: 691, y: 0, dy: 0, dx: -100},

						{note: {label: "North American(US & Canada) recorded a higher onfirmed cases  post lockdown lifting in some US States.",
														title:  "Raise in cases post lockdown lift", align: "right"},
								x: 830, y: 197, dy: -10, dx: -70}



						]

						// Add annotation to the chart
						const makeAnnotations = d3.annotation()
							.annotations(annotations)

						svg.append("g")
							.call(makeAnnotations)

						// Add the X Axis
						svg.append("g")
							.attr("class", "axis text")
							.attr("transform", "translate(0," + height + ")")
							.call(xAxis);

						svg.append("text")
							.attr("transform", "translate(" + (width / 2) + " ," + (-35 + height + margin.bottom) + ")")
							.attr("class", "label")
							.text("Month");

						// Add the Y Axis
						svg.append("g")
							.attr("class", "axis text")
							.call(yAxis);

						svg.append("text")
							.attr("transform", "rotate(-90)")
							.attr("y", -80)
							.attr("x", 0 - (height / 2))
							.attr("dy", "1em")
							.attr("class", "label")
							.text("NEW CONFIRMED CASES");
					});
				});
			};


			// Handle Deaths button click
			function deathsData() {
				svg.selectAll("*").remove();

				// Get the data again
				d3.csv("data/covid.csv")
				.then(function(data) {
					data.forEach(function(d) {
						d.Month = d.Month;
						d.Confirmed = +d.Confirmed;
						d.Deaths = +d.Deaths
						d.Recovered = +d.Recovered
					});

				// Scale the range of data
				x.domain(d3.extent(data, function(d) { return d.Month; }));
				y.domain([0, d3.max(data, function(d) { return d.Deaths; })]);

				// Nest the entries by Region
				var dataNest = d3.nest()
					.key(function(d) {return d.Region;})
					.entries(data);

					// Loop through each symbol/key
					dataNest.forEach(function(d,i) {
						svg.append("path")
							.attr("class", "line")
							.style("stroke", function() {
							   return d.color = color(d.key); })
							.attr("id", 'tag'+d.key.replace(/[\s\&]+/g, ''))
							.attr("d", deathline(d.values));

						// Add points with tooltips
						svg.selectAll("dot")
							.data(data)
						.enter().append("circle")
							.attr("r", 3.5)
							.attr("cx", function(d) { return x(d.Month); })
							.attr("cy", function(d) { return y(d.Deaths); })
							.style("fill", "grey")
							.on("mouseover", function(d) {
								d3.select(this)
									.attr("r", 8)
        							.style("fill", "purple");
								div.transition()
									.duration(200)
									.style("opacity", 0.9);
								div.html(
										"Region: " + d.Region + "<br/>" +
										"Month: " + d.Month + "<br/>" +
										"Confirmed: " + d.Confirmed + " <br/>" +
										"Deaths: " + d.Deaths + "<br/>" +
										"Recovered: " + d.Recovered)
									.style("left", (d3.event.pageX) + "px")
									.style("top", (d3.event.pageY - 28) + "px");
							})
							.on("mouseout", function(d) {
								d3.select(this)
									.attr("r", 3.5)
        							.style("fill", "grey");
								div.transition()
									.duration(500)
									.style("opacity", 0);
							});

						// Add Legend
						svg.append("text")
							.attr("x", 25)
							.attr("y", 20)
							.attr("class", "legend")
							.text("LEGEND - WORLD REGIONS")

						svg.append("line")
							.attr("x1", 25)
							.attr("x2", 45)
							.attr("y1", 40 + i * 20)
							.attr("y2", 40 + i * 20)
							.style("stroke-width", 3)
							.style("stroke", function() {
								return d.color = color(d.key); })
							.on("click", function(){
								var active   = d.active ? false : true,
								newOpacity = active ? 0.10 : 1;
								d3.select("#tag"+d.key.replace(/[\s\&]+/g, ''))
									.transition().duration(100)
									.style("opacity", newOpacity);
								d.active = active;
								});

						var active = true;
						svg.append("text")
							.attr("x", 55)
							.attr("y", 46 + i * 20)
							.attr("class", "legend")
							.style("fill", function() {
								return d.color = color(d.key); })
							.on("click", function(){
							    active   = d.active ? false : true;
								// alert("test"+d.active);
								newOpacity = active ? 0.10 : 1;
								// alert("#tag"+d.key.replace(/[\s\&]+/g, ''));
								d3.select("#tag"+d.key.replace(/[\s\&]+/g, ''))
									.transition().duration(100)
									.style("opacity", newOpacity);
								// alert(active);
								d.active = active;
								})
							.text(d.key);

						// Add Annotations
						svg.append("rect")
							.attr("x", 500)
							.attr("y", 0)
							.attr("width", 300)
							.attr("height", 100)
							.attr("fill", "grey")
							.attr("fill-opacity", 0.05)

						svg.append("text")
							.attr("x", 510)
							.attr("y", 20)
							.attr("font-size", "14px")
							.text("The sudden raise in new cases, reaching")
						svg.append("text")
							.attr("x", 510)
							.attr("y", 40)
							.attr("font-size", "14px")
							.text("limits on hospital capacity resulted in higher,")
						svg.append("text")
							.attr("x", 510)
							.attr("y",60)
							.attr("font-size", "14px")
							.text("Deaths in Europe & Central Asia in Apr 2020 ")
						svg.append("text")
							.attr("x", 510)
							.attr("y", 90)
							.attr("font-size", "14px")
							.text("Deaths trend downwards in most regions")


						// Add the X Axis
						svg.append("g")
							.attr("class", "axis text")
							.attr("transform", "translate(0," + height + ")")
							.call(xAxis);

						svg.append("text")
							.attr("transform", "translate(" + (width / 2) + " ," + (-35 + height + margin.bottom) + ")")
							.attr("class", "label")
							.text("Month");

						// Add the Y Axis
						svg.append("g")
							.attr("class", "axis text")
							.call(yAxis);

						svg.append("text")
							.attr("transform", "rotate(-90)")
							.attr("y", -80)
							.attr("x", 0 - (height / 2))
							.attr("dy", "1em")
							.attr("class", "label")
							.text("TOTAL DEATHS");
					});
				});
			};

			// Handle Recovered button click
			function recoveredData() {
				svg.selectAll("*").remove();

				// Get the data again
				d3.csv("data/covid.csv")
				.then(function(data) {
					data.forEach(function(d) {
						d.Month = d.Month;
						d.Confirmed = +d.Confirmed;
						d.Deaths = +d.Deaths
						d.Recovered = +d.Recovered
					});

				// Scale the range of data
				x.domain(d3.extent(data, function(d) { return d.Month; }));
				y.domain([0, d3.max(data, function(d) { return d.Recovered; })]);

				// Nest the entries by Region
				var dataNest = d3.nest()
					.key(function(d) {return d.Region;})
					.entries(data);

					// Loop through each symbol/key
					dataNest.forEach(function(d,i) {
						svg.append("path")
							.attr("class", "line")
							.style("stroke", function() {
							   return d.color = color(d.key); })
							.attr("id", 'tag'+d.key.replace(/[\s\&]+/g, ''))
							.attr("d", recoveredline(d.values));

						// Add points with tooltips
						svg.selectAll("dot")
							.data(data)
						.enter().append("circle")
							.attr("r", 3.5)
							.attr("cx", function(d) { return x(d.Month); })
							.attr("cy", function(d) { return y(d.Recovered); })
							.style("fill", "grey")
							.on("mouseover", function(d) {
								d3.select(this)
									.attr("r", 8)
        							.style("fill", "purple");
								div.transition()
									.duration(200)
									.style("opacity", 0.9);
								div.html(
										"Region: " + d.Region + "<br/>" +
										"Month: " + d.Month + "<br/>" +
										"Confirmed: " + d.Confirmed + " <br/>" +
										"Deaths: " + d.Deaths + "<br/>" +
										"Recovered: " + d.Recovered)
									.style("left", (d3.event.pageX) + "px")
									.style("top", (d3.event.pageY - 28) + "px");
							})
							.on("mouseout", function(d) {
								d3.select(this)
									.attr("r", 3.5)
        							.style("fill", "grey");
								div.transition()
									.duration(500)
									.style("opacity", 0);
							});

						// Add Legend
						svg.append("text")
							.attr("x", 25)
							.attr("y", 20)
							.attr("class", "legend")
							.text("LEGEND - WORLD REGIONS")

						svg.append("line")
							.attr("x1", 25)
							.attr("x2", 45)
							.attr("y1", 40 + i * 20)
							.attr("y2", 40 + i * 20)
							.style("stroke-width", 3)
							.style("stroke", function() {
								return d.color = color(d.key); })
							.on("click", function(){
								var active   = d.active ? false : true,
								newOpacity = active ? 0.10 : 1;
								d3.select("#tag"+d.key.replace(/[\s\&]+/g, ''))
									.transition().duration(100)
									.style("opacity", newOpacity);
								d.active = active;
								});

						var active = true;
						svg.append("text")
							.attr("x", 55)
							.attr("y", 46 + i * 20)
							.attr("class", "legend")
							.style("fill", function() {
								return d.color = color(d.key); })
							.on("click", function(){
							    active   = d.active ? false : true;
								// alert("test"+d.active);
								newOpacity = active ? 0.10 : 1;
								// alert("#tag"+d.key.replace(/[\s\&]+/g, ''));
								d3.select("#tag"+d.key.replace(/[\s\&]+/g, ''))
									.transition().duration(100)
									.style("opacity", newOpacity);
								// alert(active);
								d.active = active;
								})
							.text(d.key);

						// Add Annotations
						svg.append("rect")
							.attr("x", 250)
							.attr("y", 0)
							.attr("width", 300)
							.attr("height", 110)
							.attr("fill", "grey")
							.attr("fill-opacity", 0.05)

						svg.append("text")
							.attr("x", 260)
							.attr("y", 20)
							.attr("font-size", "14px")
							.text("Recovery trend is in propotion with the new ")
						svg.append("text")
							.attr("x", 260)
							.attr("y", 40)
							.attr("font-size", "14px")
							.text("cases recorded, Most Regions are recovering")
						svg.append("text")
							.attr("x", 260)
							.attr("y",60)
							.attr("font-size", "14px")
							.text("well")
						svg.append("text")
							.attr("x", 260)
							.attr("y", 80)
							.attr("font-size", "14px")
							.text("Necessary levels for herd immunity yet to be")
						svg.append("text")
							.attr("x", 260)
							.attr("y", 100)
							.attr("font-size", "14px")
							.text("attained")


						// Add the X Axis
						svg.append("g")
							.attr("class", "axis text")
							.attr("transform", "translate(0," + height + ")")
							.call(xAxis);

						svg.append("text")
							.attr("transform", "translate(" + (width / 2) + " ," + (-35 + height + margin.bottom) + ")")
							.attr("class", "label")
							.text("Month");

						// Add the Y Axis
						svg.append("g")
							.attr("class", "axis text")
							.call(yAxis);

						svg.append("text")
							.attr("transform", "rotate(-90)")
							.attr("y", -80)
							.attr("x", 0 - (height / 2))
							.attr("dy", "1em")
							.attr("class", "label")
							.text("TOTAL RECOVERED CASES");
					});
				});
			};
		</script>


	</div>

	<div class="container-fluid">
		<h4><strong>Conclusion:</strong></h4>
		<p>
		What started in a seafood market (Huanan Seafood Wholesale Market), identified as a suspected center, had far reaching impacts and are far from over.<br>
		The Economic impacts are just being felt in the world regions and will have a long tail
		</p>
	</div>

</body>
</html>